# 飞书多维表格配置说明

## 🎯 功能概述

系统已集成飞书多维表格API，提取的数据将直接写入指定的飞书多维表格中。

## 🔧 配置步骤

### 1. 创建飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/app)
2. 点击"创建应用"
3. 填写应用信息：
   - 应用名称：社交媒体链接提取器
   - 应用描述：自动提取网站信息并写入多维表格
   - 应用图标：选择合适的图标

### 2. 获取应用凭证

创建应用后，在应用详情页面获取：
- **App ID**: 应用唯一标识
- **App Secret**: 应用密钥

### 3. 配置应用权限

在应用详情页面，配置以下权限：
- **多维表格**: 读写权限
- **多维表格数据**: 读写权限

### 4. 发布应用

1. 在"版本管理与发布"页面创建版本
2. 填写版本信息
3. 提交审核并发布

### 5. 设置环境变量

在服务器上设置环境变量：

```bash
# Linux/Mac
export FEISHU_APP_ID="your_app_id_here"
export FEISHU_APP_SECRET="your_app_secret_here"

# Windows
set FEISHU_APP_ID=your_app_id_here
set FEISHU_APP_SECRET=your_app_secret_here
```

或者在代码中直接修改配置：

```javascript
const FEISHU_CONFIG = {
    APP_ID: 'your_app_id_here',
    APP_SECRET: 'your_app_secret_here',
    BITABLE_APP_TOKEN: 'F1lbw4vsWie5BHktQVVcj89fn11',
    TABLE_ID: 'tblFjiGso24abRHl',
    VIEW_ID: 'vewla1O8gN'
};
```

## 📊 多维表格结构

### 表格字段配置

确保飞书多维表格包含以下字段：

| 字段名称 | 字段类型 | 说明 |
|---------|---------|------|
| 官网 | 文本 | 提取的网站URL |
| 公司名称 | 文本 | 公司/品牌名称 |
| 公司简介 | 多行文本 | 公司描述信息 |
| 地址 | 文本 | 公司地址 |
| 邮箱 | 文本 | 联系邮箱 |
| 电话 | 文本 | 联系电话 |
| Instagram | 文本 | Instagram链接 |
| Facebook | 文本 | Facebook链接 |
| 提取时间 | 日期时间 | 数据提取时间 |

### 表格配置信息

- **多维表格链接**: https://lcndthcvl1e0.feishu.cn/wiki/F1lbw4vsWie5BHktQVVcj89fn11
- **表格ID**: tblFjiGso24abRHl
- **视图ID**: vewla1O8gN

## 🔧 技术实现

### API调用流程

1. **获取访问令牌**
   ```javascript
   POST /auth/v3/tenant_access_token/internal
   {
     "app_id": "your_app_id",
     "app_secret": "your_app_secret"
   }
   ```

2. **写入数据**
   ```javascript
   POST /bitable/v1/apps/{app_token}/tables/{table_id}/records
   {
     "fields": {
       "官网": "http://example.com",
       "公司名称": "Example Company",
       // ... 其他字段
     }
   }
   ```

### 错误处理

- **认证失败**: 检查App ID和App Secret是否正确
- **权限不足**: 确保应用有多维表格读写权限
- **字段不匹配**: 检查表格字段名称是否与代码中的一致
- **网络错误**: 检查网络连接和API地址

## 🧪 测试验证

### 1. 测试API连接

```bash
curl -X POST http://localhost:3000/api/extract \
  -H "Content-Type: application/json" \
  -d '{"url":"http://www.langaard.no/"}'
```

### 2. 检查响应

成功响应示例：
```json
{
  "success": true,
  "results": {
    "companyName": "Juveler Langaard",
    "description": "Besøk vår butikk...",
    "address": "STORTINGSGT. 22, 0161 OSLO",
    "email": "INFO@LANGAARD.NO",
    "phone": "+47 22 00 76 90",
    "instagram": ["https://www.instagram.com/juvelerlangaard/"],
    "facebook": ["https://www.facebook.com/juvelerlangaard/"]
  },
  "url": "http://www.langaard.no/",
  "feishuSuccess": true
}
```

### 3. 验证数据写入

检查飞书多维表格是否新增了记录，包含：
- ✅ 官网URL
- ✅ 公司信息
- ✅ 联系方式
- ✅ 社交媒体链接
- ✅ 提取时间

## 🔍 常见问题

### Q: 如何获取App ID和App Secret？
A: 在飞书开放平台创建应用后，在应用详情页面可以找到这些信息。

### Q: 为什么写入失败？
A: 可能的原因：
- App ID或App Secret错误
- 应用权限不足
- 表格字段名称不匹配
- 网络连接问题

### Q: 如何修改表格字段？
A: 在飞书多维表格中编辑字段名称，然后同步修改代码中的字段映射。

### Q: 数据写入有延迟吗？
A: 通常写入是实时的，但可能受到网络状况影响。

## 🚀 功能特点

### 优势
- **直接写入**: 无需中间服务，直接写入飞书多维表格
- **实时同步**: 提取完成后立即写入
- **错误容错**: 写入失败不影响提取结果
- **状态反馈**: 界面显示写入状态

### 数据完整性
- ✅ 所有提取信息都会写入
- ✅ 包含时间戳记录
- ✅ 支持多语言内容
- ✅ 自动处理空值

---

**配置完成后，提取的数据将自动写入飞书多维表格！** 🎉
