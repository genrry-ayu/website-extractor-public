# 🎯 **方案B验证清单**

## ✅ **系统状态检查**

### 1. **Health Check - 验证环境变量**
```bash
curl https://unrivaled-pavlova-43ddb4.netlify.app/.netlify/functions/health
```

**期望结果：**
```json
{
  "ok": true,
  "config": {
    "hasAppId": true,
    "hasAppSecret": true,
    "hasTableId": true,
    "hasEncKey": true
  }
}
```

### 2. **未登录用户测试**
```bash
curl -X POST https://unrivaled-pavlova-43ddb4.netlify.app/.netlify/functions/extract \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com"}'
```

**期望结果：**
- 如果环境变量已设置：`{"ok": true, "results": {...}, "feishuSuccess": true}`
- 如果环境变量未设置：`{"ok": false, "error": "missing_config", "fields": {...}}`

### 3. **登录用户测试**
1. 访问：https://unrivaled-pavlova-43ddb4.netlify.app/
2. 点击"登录"按钮
3. 使用Netlify Identity登录
4. 配置个人飞书信息
5. 测试提取功能

## 🔧 **环境变量设置**

在Netlify控制台中设置以下环境变量：

```
CONFIG_ENC_KEY = ba5b32d86caf37ba79e4bf41a0ae636f82dcbf01e66890f807dca7b3f570555b
FEISHU_APP_ID = [你的飞书App ID]
FEISHU_APP_SECRET = [你的飞书App Secret]
FEISHU_TABLE_ID = [你的飞书Table ID]
```

## 📋 **功能验证**

### ✅ **已实现功能**
- [x] 未登录用户：使用环境变量配置
- [x] 登录用户：使用个人私有配置
- [x] 配置加密存储（AES-256-GCM）
- [x] 错误处理完善（400/401/500区分）
- [x] 网站信息提取
- [x] 飞书多维表格写入
- [x] 社交媒体链接提取（纯文本显示）

### 🔄 **工作流程**
1. **未登录用户**：
   - 使用环境变量配置
   - 可以正常提取和写入飞书

2. **登录用户**：
   - 优先使用个人配置
   - 如果个人配置不存在，回退到环境变量
   - 可以保存和管理个人配置

## 🚨 **常见问题排查**

### 1. **500错误**
- 检查Netlify Functions日志
- 确认环境变量已设置
- 验证Blobs配置

### 2. **400错误**
- 检查是否缺少必要配置
- 验证URL格式是否正确

### 3. **401错误**
- 确认用户已登录（仅config-save/get需要）
- 检查JWT令牌是否有效

## 🎉 **成功标志**

当看到以下结果时，说明系统完全正常：

```json
{
  "ok": true,
  "requestId": "abc123",
  "url": "https://example.com",
  "results": {
    "companyName": "示例公司",
    "description": "公司描述",
    "address": "公司地址",
    "email": "contact@example.com",
    "phone": "+1234567890",
    "instagram": ["https://instagram.com/example"],
    "facebook": ["https://facebook.com/example"]
  },
  "feishuSuccess": true
}
```
