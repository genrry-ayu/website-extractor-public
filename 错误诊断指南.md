# 🔍 **错误诊断指南**

## 🎯 **错误码对照表**

现在系统会返回明确的错误码，而不是模糊的500错误。以下是各种错误码的含义和解决方案：

### **401 - auth_required**
**含义**：用户未登录或登录已过期
**解决方案**：
1. 点击右上角"登录"按钮
2. 使用Netlify Identity登录
3. 重新尝试操作

### **404 - not_found**
**含义**：用户已登录但未保存个人配置
**解决方案**：
1. 访问配置页面：https://unrivaled-pavlova-43ddb4.netlify.app/config
2. 填写飞书配置信息
3. 点击"保存配置"

### **409 - enc_key_mismatch**
**含义**：加密密钥不匹配，配置无法解密
**解决方案**：
1. 清除旧配置（浏览器控制台执行）：
   ```javascript
   extractor.clearUserConfig().then(result => {
       if (result.ok) {
           console.log('配置已清除，请重新保存配置');
       }
   });
   ```
2. 重新保存配置

### **400 - missing_fields**
**含义**：保存配置时缺少必要字段
**解决方案**：
1. 检查表单是否完整填写
2. 确保App ID、App Secret、Table ID都已填写

### **500 - internal_error**
**含义**：服务器内部错误
**解决方案**：
1. 检查Netlify Functions日志
2. 联系管理员

## 🧪 **测试流程**

### **1. 检查登录状态**
```javascript
console.log('当前用户:', netlifyIdentity.currentUser());
```

### **2. 检查配置状态**
```javascript
extractor.checkConfigStatus().then(status => {
    console.log('配置状态:', status);
});
```

### **3. 测试配置保存**
1. 访问配置页面
2. 填写配置信息
3. 点击保存
4. 查看控制台输出

### **4. 测试提取功能**
1. 输入测试URL
2. 点击提取
3. 查看结果

## 🔧 **快速修复命令**

### **清除用户配置**
```javascript
extractor.clearUserConfig().then(result => {
    console.log('清除结果:', result);
});
```

### **检查环境变量**
```bash
curl https://unrivaled-pavlova-43ddb4.netlify.app/.netlify/functions/health
```

### **测试配置获取**
```javascript
// 需要先登录
extractor.authedFetch('/.netlify/functions/config-get').then(data => {
    console.log('配置数据:', data);
});
```

## 🚨 **常见问题排查**

### **问题1：一直提示需要登录**
- 检查Netlify Identity是否正确配置
- 确认用户已登录
- 刷新页面重试

### **问题2：配置保存失败**
- 检查字段是否完整
- 确认网络连接正常
- 查看浏览器控制台错误

### **问题3：提取功能失败**
- 确认已保存配置
- 检查飞书API权限
- 验证Table ID格式

## 📋 **调试清单**

- [ ] 用户已登录（`netlifyIdentity.currentUser()` 不为null）
- [ ] 配置已保存（`checkConfigStatus()` 返回 `ok: true`）
- [ ] 环境变量已设置（health端点返回 `hasEncKey: true`）
- [ ] 网络连接正常
- [ ] 飞书API权限正确

## 🎉 **成功标志**

当看到以下结果时，说明系统正常工作：

- ✅ 登录成功
- ✅ 配置保存成功
- ✅ 提取功能正常
- ✅ 飞书写入成功

**如果遇到任何问题，请提供具体的错误码，我可以提供针对性的解决方案！** 🚀




