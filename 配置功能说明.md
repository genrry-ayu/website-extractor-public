# 飞书配置功能说明

## 🎯 功能概述

系统新增了飞书配置管理功能，用户可以在配置页面设置飞书应用的App ID、App Secret和多维表格链接，配置信息将加密保存在本地浏览器中，确保数据安全。

## 🔧 功能特点

### ✅ 安全加密
- **AES加密**: 使用AES-256加密算法保护配置信息
- **本地存储**: 配置信息仅保存在用户本地浏览器中
- **密钥生成**: 基于用户浏览器信息生成唯一加密密钥
- **无服务器存储**: 配置信息不会上传到服务器

### 🎨 用户友好
- **独立配置页面**: 专门的配置界面，操作简单
- **表单验证**: 实时验证输入格式和必填字段
- **状态反馈**: 清晰的成功/错误提示信息
- **自动跳转**: 配置完成后自动返回主页

### 🔄 双向同步
- **本地保存**: 配置信息加密保存在浏览器本地存储
- **服务器更新**: 配置同时发送到服务器更新运行配置
- **实时生效**: 配置更新后立即生效，无需重启服务

## 🚀 使用流程

### 1. 访问配置页面
- 在主页点击右上角的"飞书配置"按钮
- 或直接访问 `config.html`

### 2. 填写配置信息
- **App ID**: 飞书应用的唯一标识
- **App Secret**: 飞书应用的安全密钥
- **多维表格链接**: 目标多维表格的访问链接

### 3. 保存配置
- 点击"保存配置"按钮
- 系统将验证并加密保存配置
- 同时更新服务器端配置

### 4. 返回使用
- 配置完成后自动返回主页
- 可以开始正常使用提取功能

## 🔐 安全机制

### 加密算法
```javascript
// 基于用户浏览器信息生成唯一密钥
const userAgent = navigator.userAgent;
const screenInfo = `${screen.width}x${screen.height}`;
const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
const baseString = `${userAgent}|${screenInfo}|${timezone}|feishu_config`;
const encryptionKey = CryptoJS.SHA256(baseString).toString();

// AES加密配置数据
const encryptedData = CryptoJS.AES.encrypt(jsonString, encryptionKey).toString();
```

### 数据保护
- **本地存储**: 使用localStorage存储加密数据
- **密钥隔离**: 每个用户的加密密钥都是唯一的
- **无明文存储**: 敏感信息始终以加密形式存储
- **自动清理**: 支持清除配置功能

## 📋 配置验证

### 输入验证
- **必填字段**: App ID、App Secret、多维表格链接都是必填项
- **格式验证**: 多维表格链接必须是有效的飞书链接
- **长度限制**: 各字段有合理的长度限制

### 链接格式
```javascript
// 有效的多维表格链接格式
https://lcndthcvl1e0.feishu.cn/wiki/F1lbw4vsWie5BHktQVVcj89fn11
https://example.feishu.cn/base/xxx
```

## 🔄 配置管理

### 保存配置
```javascript
// 保存流程
1. 验证输入数据
2. 加密配置信息
3. 保存到localStorage
4. 发送到服务器更新
5. 显示成功提示
```

### 加载配置
```javascript
// 加载流程
1. 从localStorage读取加密数据
2. 使用密钥解密
3. 填充表单字段
4. 显示加载状态
```

### 清除配置
```javascript
// 清除流程
1. 删除localStorage中的数据
2. 清空表单字段
3. 显示清除成功提示
```

## 🎯 用户体验

### 智能提示
- **配置检查**: 提取前自动检查是否有配置
- **引导提示**: 无配置时引导用户前往配置页面
- **状态显示**: 实时显示配置保存/加载状态

### 错误处理
- **网络错误**: 本地保存成功，服务器更新失败时给出提示
- **解密失败**: 配置损坏时自动清除并提示重新配置
- **格式错误**: 输入格式不正确时给出具体错误信息

## 🔧 技术实现

### 前端技术
- **HTML5**: 语义化标签和表单验证
- **CSS3**: 现代化样式和动画效果
- **JavaScript ES6+**: 异步操作和加密功能
- **CryptoJS**: AES加密算法库

### 后端接口
```javascript
// 配置更新接口
POST /api/config
{
  "appId": "your_app_id",
  "appSecret": "your_app_secret", 
  "bitableUrl": "https://example.feishu.cn/wiki/xxx"
}
```

### 数据流程
```
用户输入 → 前端验证 → 加密存储 → 发送服务器 → 更新配置 → 返回主页
```

## 📱 响应式设计

### 移动端适配
- **触摸友好**: 按钮和输入框适合触摸操作
- **自适应布局**: 在不同屏幕尺寸下自动调整
- **字体优化**: 移动端字体大小和间距优化

### 桌面端体验
- **键盘操作**: 支持Tab键导航和回车键提交
- **鼠标交互**: 悬停效果和点击反馈
- **大屏布局**: 充分利用大屏幕空间

## 🔮 未来扩展

### 计划功能
- **配置导入/导出**: 支持配置文件的导入导出
- **多环境配置**: 支持开发、测试、生产环境配置
- **配置模板**: 提供常用配置模板
- **配置历史**: 保存配置修改历史

### 安全增强
- **生物识别**: 支持指纹/面部识别解锁配置
- **硬件密钥**: 支持硬件安全密钥
- **配置备份**: 云端安全备份功能

---

**配置功能已完全集成，提供安全、便捷的飞书应用配置管理！** 🎉
